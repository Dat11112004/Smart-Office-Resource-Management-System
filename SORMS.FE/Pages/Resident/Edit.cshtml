@{
    ViewData["Title"] = "Cập nhật cư dân";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var id = Context.Request.RouteValues["id"];
}

<div class="container mt-4" style="max-width: 600px;">
    <h3 class="mb-4 text-center">Cập nhật thông tin cư dân</h3>
    <form id="editForm">
        <div class="mb-3">
            <label>Họ và tên</label>
            <input type="text" id="fullName" class="form-control" required />
        </div>
        <div class="mb-3">
            <label>Email</label>
            <input type="email" id="email" class="form-control" required />
        </div>
        <div class="mb-3">
            <label>Số điện thoại</label>
            <input type="text" id="phone" class="form-control" />
        </div>
        <div class="mb-3">
            <label>Mã phòng</label>
            <input type="number" id="roomId" class="form-control" />
        </div>
        <button type="submit" class="btn btn-warning w-100">Lưu thay đổi</button>
        <a href="/Resident/Index" class="btn btn-secondary w-100 mt-2">Quay lại</a>
    </form>
</div>

@section Scripts {
    <script>
        const id = "@id";

        async function loadResident() {
            const res = await fetch(`/api/Resident/${id}`, {
                headers: { "Authorization": "Bearer " + localStorage.getItem("token") }
            });
            const r = await res.json();
            fullName.value = r.fullName;
            email.value = r.email;
            phone.value = r.phone;
            roomId.value = r.roomId;
        }

        document.getElementById("editForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const res = await fetch(`/api/Resident/${id}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + localStorage.getItem("token")
                },
                body: JSON.stringify({
                    fullName: fullName.value,
                    email: email.value,
                    phone: phone.value,
                    roomId: parseInt(roomId.value)
                })
            });
            if (res.ok) {
                alert("Cập nhật thành công!");
                window.location.href = "/Resident/Index";
            } else alert("Không thể cập nhật cư dân!");
        });

        loadResident();
    </script>
}
