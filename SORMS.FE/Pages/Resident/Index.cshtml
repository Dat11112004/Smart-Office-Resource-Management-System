@page
@model SORMS.FE.Pages.Resident.IndexModel
@{
    ViewData["Title"] = "Quản lý Cư dân";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<div class="page-header mb-4">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h1 class="text-gradient mb-2">
                <i class="fas fa-users me-2"></i>
                Quản lý Cư dân
            </h1>
            <p class="text-muted mb-0">Danh sách và quản lý thông tin cư dân trong hệ thống</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="/Resident/Create" class="btn btn-primary btn-modern">
                <i class="fas fa-plus me-2"></i>
                Thêm cư dân mới
            </a>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-number">@Model.TotalResidents</div>
            <div class="stat-label">Tổng số cư dân</div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="stat-card success">
            <div class="stat-icon">
                <i class="fas fa-user-check"></i>
            </div>
            <div class="stat-number">@Model.ActiveResidents</div>
            <div class="stat-label">Cư dân hoạt động</div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="stat-card warning">
            <div class="stat-icon">
                <i class="fas fa-user-clock"></i>
            </div>
            <div class="stat-number">@Model.PendingResidents</div>
            <div class="stat-label">Chờ duyệt</div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="stat-card info">
            <div class="stat-icon">
                <i class="fas fa-user-plus"></i>
            </div>
            <div class="stat-number">@Model.NewThisMonth</div>
            <div class="stat-label">Mới trong tháng</div>
        </div>
    </div>
</div>

<!-- Filters and Search -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" class="form-control" placeholder="Tìm kiếm theo tên, email..." id="searchInput">
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <select class="form-control" id="statusFilter">
                    <option value="">Tất cả trạng thái</option>
                    <option value="active">Hoạt động</option>
                    <option value="inactive">Không hoạt động</option>
                    <option value="pending">Chờ duyệt</option>
                </select>
            </div>
            <div class="col-md-3 mb-3">
                <select class="form-control" id="roomFilter">
                    <option value="">Tất cả phòng</option>
                    <option value="101">Phòng 101</option>
                    <option value="102">Phòng 102</option>
                    <option value="103">Phòng 103</option>
                </select>
            </div>
            <div class="col-md-2 mb-3">
                <button class="btn btn-outline-secondary w-100" id="clearFilters">
                    <i class="fas fa-times me-1"></i>
                    Xóa bộ lọc
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Residents Table -->
<div class="card">
    <div class="card-header">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>
                    Danh sách cư dân
                </h5>
            </div>
            <div class="col-md-6 text-end">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="exportBtn">
                        <i class="fas fa-download me-1"></i>
                        Xuất Excel
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="refreshBtn">
                        <i class="fas fa-sync-alt me-1"></i>
                        Làm mới
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-modern mb-0" id="residentsTable">
                <thead>
                    <tr>
                        <th>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="selectAll">
                            </div>
                        </th>
                        <th>Cư dân</th>
                        <th>Email</th>
                        <th>Số điện thoại</th>
                        <th>Phòng</th>
                        <th>Ngày vào</th>
                        <th>Trạng thái</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var resident in Model.Residents)
                    {
                        <tr>
                            <td>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="@resident.Id">
                                </div>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="avatar me-3">
                                        <i class="fas fa-user-circle text-primary" style="font-size: 2rem;"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold">@resident.FullName</div>
                                        <small class="text-muted">ID: @resident.Id</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <a href="mailto:@resident.Email" class="text-decoration-none">
                                    @resident.Email
                                </a>
                            </td>
                            <td>
                                <a href="tel:@resident.PhoneNumber" class="text-decoration-none">
                                    @resident.PhoneNumber
                                </a>
                            </td>
                            <td>
                                <span class="badge-modern bg-primary">@resident.RoomNumber</span>
                            </td>
                            <td>
                                <span class="text-muted">@(resident.CheckInDate?.ToString("dd/MM/yyyy") ?? "N/A")</span>
                            </td>
                            <td>
                                @if (resident.IsActive == true)
                                {
                                    <span class="badge-status active">
                                        <i class="fas fa-check-circle me-1"></i>
                                        Hoạt động
                                    </span>
                                }
                                else
                                {
                                    <span class="badge-status inactive">
                                        <i class="fas fa-times-circle me-1"></i>
                                        Không hoạt động
                                    </span>
                                }
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <a href="/Resident/Details/@resident.Id" class="btn btn-outline-info btn-sm" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="/Resident/Edit/@resident.Id" class="btn btn-outline-warning btn-sm" title="Chỉnh sửa">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="/Resident/Delete/@resident.Id" class="btn btn-outline-danger btn-sm btn-delete" 
                                       title="Xóa" data-item-name="@resident.FullName">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer">
        <div class="row align-items-center">
            <div class="col-md-6">
                <div class="d-flex align-items-center">
                    <span class="me-3">Hiển thị:</span>
                    <select class="form-control form-control-sm" style="width: auto;" id="pageSize">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="ms-2 text-muted">trên tổng số @Model.TotalResidents cư dân</span>
                </div>
            </div>
            <div class="col-md-6">
                <nav aria-label="Page navigation">
                    <ul class="pagination pagination-sm justify-content-end mb-0">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Trước</a>
                        </li>
                        <li class="page-item active">
                            <a class="page-link" href="#">1</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">2</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">3</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">Tiếp</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Actions Modal -->
<div class="modal fade" id="bulkActionsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thao tác hàng loạt</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Bạn đã chọn <span id="selectedCount">0</span> cư dân.</p>
                <div class="d-grid gap-2">
                    <button class="btn btn-warning" id="bulkActivate">
                        <i class="fas fa-check-circle me-2"></i>
                        Kích hoạt hàng loạt
                    </button>
                    <button class="btn btn-secondary" id="bulkDeactivate">
                        <i class="fas fa-times-circle me-2"></i>
                        Vô hiệu hóa hàng loạt
                    </button>
                    <button class="btn btn-danger" id="bulkDelete">
                        <i class="fas fa-trash me-2"></i>
                        Xóa hàng loạt
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Search functionality
            $('#searchInput').on('keyup', function() {
                const searchTerm = $(this).val().toLowerCase();
                $('#residentsTable tbody tr').each(function() {
                    const rowText = $(this).text().toLowerCase();
                    $(this).toggle(rowText.includes(searchTerm));
                });
            });

            // Filter functionality
            $('#statusFilter, #roomFilter').on('change', function() {
                filterTable();
            });

            function filterTable() {
                const statusFilter = $('#statusFilter').val();
                const roomFilter = $('#roomFilter').val();
                
                $('#residentsTable tbody tr').each(function() {
                    let showRow = true;
                    
                    if (statusFilter) {
                        const status = $(this).find('.badge-status').text().toLowerCase();
                        if (!status.includes(statusFilter)) {
                            showRow = false;
                        }
                    }
                    
                    if (roomFilter && showRow) {
                        const roomNumber = $(this).find('.badge-modern').text();
                        if (roomNumber !== roomFilter) {
                            showRow = false;
                        }
                    }
                    
                    $(this).toggle(showRow);
                });
            }

            // Clear filters
            $('#clearFilters').on('click', function() {
                $('#searchInput').val('');
                $('#statusFilter').val('');
                $('#roomFilter').val('');
                $('#residentsTable tbody tr').show();
            });

            // Select all functionality
            $('#selectAll').on('change', function() {
                const isChecked = $(this).is(':checked');
                $('#residentsTable tbody input[type="checkbox"]').prop('checked', isChecked);
                updateBulkActions();
            });

            // Individual checkbox change
            $('#residentsTable tbody input[type="checkbox"]').on('change', function() {
                updateBulkActions();
            });

            function updateBulkActions() {
                const selectedCount = $('#residentsTable tbody input[type="checkbox"]:checked').length;
                $('#selectedCount').text(selectedCount);
                
                if (selectedCount > 0) {
                    $('#bulkActionsModal').modal('show');
                }
            }

            // Export functionality
            $('#exportBtn').on('click', function() {
                SORMS.showNotification('Đang xuất dữ liệu...', 'info');
                // Implement export logic here
            });

            // Refresh functionality
            $('#refreshBtn').on('click', function() {
                location.reload();
            });

            // Bulk actions
            $('#bulkActivate').on('click', function() {
                SORMS.showNotification('Đang kích hoạt cư dân được chọn...', 'info');
                $('#bulkActionsModal').modal('hide');
            });

            $('#bulkDeactivate').on('click', function() {
                SORMS.showNotification('Đang vô hiệu hóa cư dân được chọn...', 'warning');
                $('#bulkActionsModal').modal('hide');
            });

            $('#bulkDelete').on('click', function() {
                if (confirm('Bạn có chắc chắn muốn xóa các cư dân được chọn?')) {
                    SORMS.showNotification('Đang xóa cư dân được chọn...', 'danger');
                    $('#bulkActionsModal').modal('hide');
                }
            });
        });
    </script>
}