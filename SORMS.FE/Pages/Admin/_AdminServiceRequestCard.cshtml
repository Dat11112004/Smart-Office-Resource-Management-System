@model SORMS.FE.Pages.Staff.ServiceRequestDto

<div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
    <div style="flex: 1;">
        <h5 style="margin: 0 0 0.5rem 0; color: #37474f; font-weight: 700;">@Model.Title</h5>
        <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
            <span class="priority-badge priority-@Model.Priority.ToLower()">
                <i class="fas fa-flag"></i> @Model.Priority
            </span>
            <span class="badge @GetStatusBadgeClass(Model.Status)" style="padding: 0.4rem 0.8rem; border-radius: 8px; font-weight: 600; font-size: 0.8rem;">
                @GetStatusText(Model.Status)
            </span>
        </div>
    </div>
</div>

<div style="background: rgba(102,126,234,0.05); padding: 1rem; border-radius: 10px; margin-bottom: 1rem;">
    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
        <i class="fas fa-user" style="color: #667eea; width: 16px;"></i>
        <strong style="color: #546e7a; font-size: 0.9rem;">Cư dân:</strong>
        <span style="color: #37474f; font-size: 0.9rem; font-weight: 600;">@Model.ResidentName</span>
    </div>
    <div style="display: flex; align-items: center; gap: 0.5rem;">
        <i class="fas fa-calendar" style="color: #667eea; width: 16px;"></i>
        <strong style="color: #546e7a; font-size: 0.9rem;">Ngày gửi:</strong>
        <span style="color: #37474f; font-size: 0.9rem;">@Model.RequestDate.ToString("dd/MM/yyyy HH:mm")</span>
    </div>
</div>

<div style="margin-bottom: 1rem;">
    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
        <i class="fas fa-tools" style="color: #546e7a; width: 16px;"></i>
        <strong style="color: #546e7a; font-size: 0.9rem;">Loại dịch vụ:</strong>
        <span style="color: #37474f; font-size: 0.9rem;">@Model.ServiceType</span>
    </div>
    <div style="display: flex; align-items: start; gap: 0.5rem;">
        <i class="fas fa-comment" style="color: #546e7a; width: 16px; margin-top: 0.2rem;"></i>
        <div style="flex: 1;">
            <strong style="color: #546e7a; font-size: 0.9rem;">Mô tả:</strong>
            <p style="color: #37474f; font-size: 0.9rem; margin: 0.25rem 0 0 0; line-height: 1.5;">@Model.Description</p>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(Model.StaffFeedback))
{
    <div style="background: rgba(67,233,123,0.1); padding: 1rem; border-radius: 10px; margin-bottom: 1rem; border-left: 3px solid #43e97b;">
        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
            <i class="fas fa-user-tie" style="color: #43e97b;"></i>
            <strong style="color: #43e97b; font-size: 0.9rem;">Phản hồi từ @Model.ReviewedBy:</strong>
        </div>
        <p style="color: #37474f; font-size: 0.9rem; margin: 0; line-height: 1.5;">@Model.StaffFeedback</p>
        @if (Model.ReviewedDate.HasValue)
        {
            <small style="color: #90a4ae; font-size: 0.8rem; margin-top: 0.5rem; display: block;">
                <i class="fas fa-clock"></i> @Model.ReviewedDate.Value.ToString("dd/MM/yyyy HH:mm")
            </small>
        }
    </div>
}

@if (Model.CompletedDate.HasValue)
{
    <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: rgba(38,166,154,0.1); border-radius: 8px; margin-bottom: 1rem;">
        <i class="fas fa-check-circle" style="color: #26a69a;"></i>
        <span style="color: #26a69a; font-weight: 600; font-size: 0.85rem;">
            Hoàn thành: @Model.CompletedDate.Value.ToString("dd/MM/yyyy HH:mm")
        </span>
    </div>
}

<div class="action-btns">
    @if (Model.Status == "Pending")
    {
        <a href="/Admin/ReviewServiceRequest/@Model.Id" class="btn btn-approve" style="text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">
            <i class="fas fa-check"></i> Phê duyệt
        </a>
        <a href="/Admin/ReviewServiceRequest/@Model.Id" class="btn btn-reject" style="text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">
            <i class="fas fa-times"></i> Từ chối
        </a>
    }
    else if (Model.Status == "Approved")
    {
        <a href="/Admin/ReviewServiceRequest/@Model.Id" class="btn btn-inprogress" style="text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">
            <i class="fas fa-spinner"></i> Bắt đầu xử lý
        </a>
    }
    else if (Model.Status == "InProgress")
    {
        <a href="/Admin/ReviewServiceRequest/@Model.Id" class="btn btn-complete" style="text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">
            <i class="fas fa-check-double"></i> Hoàn thành
        </a>
    }
    else
    {
        <a href="/Admin/ReviewServiceRequest/@Model.Id" class="btn btn-inprogress" style="background: linear-gradient(135deg, #90a4ae 0%, #78909c 100%); text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">
            <i class="fas fa-eye"></i> Xem chi tiết
        </a>
    }
</div>

@functions {
    private string GetStatusText(string status)
    {
        return status switch
        {
            "Pending" => "Chờ xử lý",
            "Approved" => "Đã duyệt",
            "InProgress" => "Đang xử lý",
            "Completed" => "Hoàn thành",
            "Rejected" => "Từ chối",
            _ => status
        };
    }

    private string GetStatusBadgeClass(string status)
    {
        return status switch
        {
            "Pending" => "bg-warning text-dark",
            "Approved" => "bg-success",
            "InProgress" => "bg-info text-dark",
            "Completed" => "bg-secondary",
            "Rejected" => "bg-danger",
            _ => "bg-secondary"
        };
    }
}
